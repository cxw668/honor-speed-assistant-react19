# Honor Speed Assistant 项目实践笔记

## 1. App.tsx

在 [App.tsx](file:///e:/web/honor-speed-assistant-react19/honor-speed-assistant-react19/src/App.tsx) 中引入的 `CssBaseline` 是 MUI (Material UI) 提供的一个非常重要的基础组件。它的主要作用是**提供一致且统一的 CSS 基础样式**，类似于传统的 `normalize.css` 或 `reset.css`。

具体来说，它的作用包括以下几个核心方面：

- **消除浏览器默认差异**：重置各浏览器的默认样式差异。
- **应用主题背景色**：自动同步主题配置中的 `background.default` 到 `<body>`。
- **设置默认字体**：全局应用主题定义的字体族与字阶。
- **优化盒子模型**：全局设置 `box-sizing: border-box`，简化响应式尺寸计算。
- **处理滚动条与文本缩放**：包含移动端优化及平滑滚动处理。

## 2. Styles & Theme (样式与主题)

项目采用了 **MUI (Material UI)** 结合 **Tailwind CSS** 的混合样式管理方案。

### 2.1 global.css

[global.css](file:///e:/web/honor-speed-assistant-react19/honor-speed-assistant-react19/src/styles/global.css) 定义了基础的全局样式。
- **Tailwind v4 集成**：仅需一行 `@import "tailwindcss";` 即可完成全部基础指令引入。
- **原子化扩展**：利用 Tailwind 快速构建复杂的响应式布局。
- **滚动条美化与布局稳定 (`.scrollbar-beauty`)**：
  - **`scrollbar-gutter: stable`**：核心技术点，在容器侧边预留滚动条空间，防止内容因滚动条出现/消失而产生左右抖动（Layout Shift）。
  - **Webkit 定制**：将滚动条宽度压缩至 `5px`，配合半透明滑块实现自适应主题的极简视觉效果。

### 2.2 ThemeContext.tsx

[ThemeContext.tsx](file:///e:/web/honor-speed-assistant-react19/honor-speed-assistant-react19/src/context/ThemeContext.tsx) 是应用的主题大脑。
- **核心逻辑解析**：
  - **`actualMode: PaletteMode` (line 11)**：MUI 定义的联合类型 (`'light' | 'dark'`)。本系统通过它将用户的 `system` 偏好映射为真实的渲染模式，确保与 MUI 生态兼容。
  - **状态初始化 (line 20)**：`return (saved as ThemeMode) || 'system'` 从 localStorage 恢复偏好，并提供 `system` 作为健壮的默认回退。
  - **系统主题监听 (line 23)**：使用 `useMediaQuery` 实时监听操作系统的暗色模式设置，实现“跟随系统”功能。
  - **主题实例缓存 (line 45)**：通过 `useMemo` 缓存 `getAppTheme` 的结果，防止 `actualMode` 未变时的重复主题计算，优化渲染性能。

### 2.3 theme.ts

[theme.ts](file:///e:/web/honor-speed-assistant-react19/honor-speed-assistant-react19/src/styles/theme.ts) 是视觉规范的定义中心。
- **全局形状与交互**：统一设置 `borderRadius: 8`，并保留 `MuiButtonBase` 的水波纹反馈。
- **视觉层级定制**：
  - **MuiPaper/MuiAppBar**：禁用深色模式下的自动叠加层 (`backgroundImage: 'none'`)，确保背景颜色纯净。
  - **AppBar 毛玻璃**：通过 `backdropFilter: 'blur(20px)'` 结合半透明背景，实现内容滚动的穿透质感。
- **精细化组件 Overrides**：
  - **Switch (iOS 风格)**：完全重写了轨道 (`track`) 与滑块 (`thumb`) 的尺寸比例，通过相邻兄弟选择器实现选中态的颜色联动。
  - **Tooltip**：根据铭文类型（攻击/生命/防御等）动态匹配配色方案，增强信息可视性。

## 3. Router (路由配置)

### 3.1 routes.tsx

[routes.tsx](file:///e:/web/honor-speed-assistant-react19/honor-speed-assistant-react19/src/router/routes.tsx) 采用了**配置驱动 UI (Config-Driven UI)** 的架构模式，这是中大型应用保持一致性的核心手段。
- **单一事实来源 (Single Source of Truth)**：通过定义 `RouteItem` 数组，将路由路径、组件实例、显示标签和图标聚合。这一配置同时驱动了底层的 `react-router` 跳转逻辑和顶部的导航菜单渲染，避免了逻辑与视图的不一致。
- **解耦设计**：
  - **加载状态抽象**：导出独立的 `Loading` 骨架屏组件，统一了应用内所有异步模块在加载阶段的视觉体验。
  - **按需加载 (Lazy Loading)**：集成 `React.lazy` 实现路由级代码分割（Code Splitting），优化首屏加载性能。

### 3.2 index.tsx

[index.tsx](file:///e:/web/honor-speed-assistant-react19/honor-speed-assistant-react19/src/router/index.tsx) 是应用的核心**布局引擎 (Layout Engine)** 与**状态分发中心**。它在技术实现上具有以下专业深度：

- **组件多态性 (Component Polymorphism)**：
  - **`component={NavLink}` (line 136, 193, 223)**：核心技术细节。利用 MUI 的 `component` 属性实现“样式与逻辑的解耦”。MUI `Button` 和 `MenuItem` 在保持其 UI 规范的同时，底层被注入了 `react-router` 的 `NavLink` 逻辑，从而获得了无刷新跳转、路由高亮（Active State）等能力。
- **视图架构设计**：
  - **视口管理**：根容器采用 `height: 100vh` + `overflow: hidden`，配合 `main` 区域的 `overflow-y: auto`。这种设计避免了双滚动条冲突，确保了顶部导航栏的固定位置与内容区的平滑滚动体验。
  - **动态高亮逻辑**：通过 `location.pathname` 与路由配置实时比对，动态应用 `primary.main` 配色与透明度背景 (`alpha`)，为用户提供直观的位置反馈。
- **复杂导航交互与状态机**：
  - **Hover 状态机实现**：利用 `isEquipmentOpen` (State) 与 `onMouseEnter/Leave` 组合，构建了一个非阻塞式的悬浮菜单交互模型。
  - **Ref 锚点与定位控制**：通过 `equipmentRef` (Ref) 锁定菜单容器的 DOM 引用，配合 CSS 的 `position: relative/absolute` 策略，确保了子菜单在复杂的 Flex 布局中依然能实现相对于父级的精准居中定位，并利用 `z-index` 管理层级遮盖。
  - **悬浮稳定性优化 (Hover Bridge)**：
  - **伪元素桥接技术**：针对导航 Tab 与下拉菜单之间的 8px 视觉间距，通过在菜单容器上使用 `::before` 伪元素构建了一个“隐形桥梁”。
  - **原理**：该伪元素填补了物理间隙，确保鼠标在跨越空白区域时，依然处于容器的事件响应范围内，彻底解决了“鼠标移出即折叠”的交互痛点。
- **多模式主题切换底层机制**：
  - **三态调度模型**：系统支持 `light` | `dark` | `system` 三种模式。底层通过 `ThemeContext` 协调 `actualMode` 的派生逻辑。
  - **系统级监听 (Media Query)**：利用 `useMediaQuery` 实时捕捉操作系统的 `prefers-color-scheme` 信号。当用户选择 `system` 模式时，应用会自动在 `light` 与 `dark` 之间无感切换。
  - **双引擎同步驱动**：
    - **MUI 引擎**：通过 `ThemeProvider` 动态注入由 `getAppTheme(actualMode)` 生成的 JSON 主题配置，驱动组件级别的样式变更。
    - **Tailwind 引擎**：通过 `useEffect` 实时操纵根节点 `document.documentElement` 的 `classList`（添加/移除 `dark` 类名），从而触发 Tailwind 的原子化暗色样式，实现了两大样式框架的深度协同。
- **异步边界处理**：
  - **Suspense 集成**：在路由出口外层包裹 `Suspense` 容器，配合 `routes.tsx` 提供的 `Loading` 组件，确保了异步资源加载过程中的用户感知连续性。

## 4. Pages (业务页面实现)

### 4.1 FightAssistPage (对战辅助系统)
项目中最复杂的业务逻辑所在地，集成了英雄间的动态博弈算法。
- **关系链推导**：基于敌我双方 10 名英雄的实时选择，从 mock 数据中提取“最佳搭档”、“压制关系”和“被压制关系”。
- **状态机管理**：处理 10 个槽位的交互状态，支持点击跳转、自动寻找空位等智能操作。

### 4.2 HeroQueryPage & InscriptionMatchPage
- **高性能过滤**：在海量英雄/铭文数据下，通过 `useMemo` 结合搜索关键字和分类标签实现毫秒级实时搜索。
- **响应式网格**：利用 MUI Grid 系统适配从手机到宽屏显示器的不同展示密度。

## 5. Business Components (业务组件深度)

### 5.1 InscriptionSimulation (铭文模拟器)
- **高级拖拽实现**：引入 `@dnd-kit` 库，实现了跨容器（备选池到六边形槽位）的物理级拖拽体验。
- **复杂几何布局**：通过 CSS `calc` 与 `transform` 动态计算 30 个六边形槽位的蜂窝状排列位置。
- **实时属性聚合**：当铭文槽位变动时，系统会递归遍历 30 个槽位，自动汇总计算超过 10 项以上的战斗属性加成。

### 5.2 HeroSelect (智能选择器)
- **稳定渲染**：使用 `useMemo` 缓存过滤结果，防止因输入框变动导致整个列表频繁重新渲染。
- **无感加载**：针对大数据量列表，通过 CSS `display` 切换状态而非销毁 DOM，保持了极佳的选择流畅度。

## 6. Custom Hooks (核心逻辑抽象)

### 6.1 useHeroData (数据治理)
这是项目最核心的数据预处理层。
- **数据清洗**：针对原始 JSON 中存在的职业重复项（如亚瑟既是战士也是坦克）进行去重。
- **多态合并**：将“元流之子”等具有多种职业形态的特殊英雄合并为单一条目，并维护内部职业数组。
- **映射关联**：动态匹配英雄 ID、名称与远程图标资源的映射关系。

## 7. Mock Data (数据工程)

项目拥有近乎完整的游戏数据体系：
- **Schema 设计**：英雄详情、装备属性、铭文数据均采用标准 JSON 格式，支持嵌套属性（如装备的合成路径、铭文的各等级增益）。
- **静态资源映射**：通过图像路径映射表，实现了数据字段与 CDN/本地资源的高效关联。
